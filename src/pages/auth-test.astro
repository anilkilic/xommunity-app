---
import Layout from "../layouts/Layout.astro";
---

<Layout title="Auth Test">
    <main class="container mx-auto p-4">
        <h1 class="text-2xl font-bold mb-4">Auth Test</h1>

        <div class="mb-8 p-4 border rounded">
            <h2 class="text-xl mb-2">Sign Up</h2>
            <div class="flex flex-col gap-2 max-w-sm">
                <input
                    type="text"
                    id="signup-name"
                    placeholder="Name"
                    class="p-2 border rounded"
                />
                <input
                    type="email"
                    id="signup-email"
                    placeholder="Email"
                    class="p-2 border rounded"
                />
                <input type="password" <main class="container mx-auto p-4" />
                <h1 class="text-2xl font-bold mb-4">Auth Test</h1>

                <div class="mb-8 p-4 border rounded">
                    <h2 class="text-xl mb-2">Sign In</h2>
                    <button
                        id="signin-twitter-btn"
                        class="bg-blue-400 text-white p-2 rounded"
                        >Sign In with Twitter</button
                    >
                </div>

                <div class="mb-8 p-4 border rounded">
                    <h2 class="text-xl mb-2">Session</h2>
                    <div id="session-data">Loading...</div>
                    <button
                        id="signout-btn"
                        class="bg-red-500 text-white p-2 rounded mt-2"
                        >Sign Out</button
                    >
                </div>
            </div>
        </div>

        <script>
            import { authClient } from "../lib/auth-client";

            const signinTwitterBtn =
                document.getElementById("signin-twitter-btn");
            const signoutBtn = document.getElementById("signout-btn");
            const sessionData = document.getElementById("session-data");

            signinTwitterBtn?.addEventListener("click", async () => {
                const { data, error } = await authClient.signIn.social({
                    provider: "twitter",
                });

                if (error) {
                    alert(error.message);
                }
            });

            signoutBtn?.addEventListener("click", async () => {
                await authClient.signOut();
                window.location.reload();
            });

            async function checkSession() {
                const { data } = await authClient.getSession();
                if (sessionData) {
                    sessionData.textContent = data
                        ? JSON.stringify(data, null, 2)
                        : "No session";
                }
            }

            checkSession();
        </script>
    </main></Layout
>
